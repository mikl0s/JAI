<!DOCTYPE html>
<html>
<head>
    <title>Vote Analysis Dashboard</title>
    <link rel="stylesheet" href="/static/admin_style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .data-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .data-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .chart-container {
            height: 400px;
            margin-top: 20px;
        }
        .chart-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .chart-col {
            flex: 1;
            min-width: 300px;
        }
    </style>
</head>
<body>
    {% include 'admin_header.html' %}
    <h1>Vote Analysis Dashboard</h1>
    
    <div class="data-section">
        <h2>Overall Vote Distribution</h2>
        <div class="chart-container">
            <canvas id="overallVoteChart"></canvas>
        </div>
    </div>
    
    <div class="data-section">
        <h2>Vote Trends (Last 30 Days)</h2>
        <div class="chart-container">
            <canvas id="voteTrendsChart"></canvas>
        </div>
    </div>
    
    <div class="data-section">
        <h2>Top Judges by Vote Count</h2>
        <div class="chart-container">
            <canvas id="topJudgesChart"></canvas>
        </div>
    </div>
    
    <div class="data-section">
        <h2>Vote Distribution for Top 5 Judges</h2>
        <div class="chart-container">
            <canvas id="judgeDistributionChart"></canvas>
        </div>
    </div>
    
    <script>
        // Parse data from Flask
        const data = JSON.parse('{{ data|tojson|safe }}');
        
        // Overall vote distribution chart
        new Chart(document.getElementById('overallVoteChart').getContext('2d'), {
            type: 'pie',
            data: {
                labels: data.vote_types.labels,
                datasets: [{
                    label: 'Vote Distribution',
                    data: data.vote_types.counts,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',  // Red for corrupt
                        'rgba(75, 192, 192, 0.7)', // Green for not corrupt
                        'rgba(255, 205, 86, 0.7)'  // Yellow for undecided
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(255, 205, 86, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
        
        // Vote trends chart
        new Chart(document.getElementById('voteTrendsChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: data.vote_trends.dates,
                datasets: [
                    {
                        label: 'Corrupt',
                        data: data.vote_trends.corrupt,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Not Corrupt',
                        data: data.vote_trends.not_corrupt,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Undecided',
                        data: data.vote_trends.undecided,
                        borderColor: 'rgba(255, 205, 86, 1)',
                        backgroundColor: 'rgba(255, 205, 86, 0.2)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Votes'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    }
                }
            }
        });
        
        // Top judges chart
        new Chart(document.getElementById('topJudgesChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: data.top_judges.names,
                datasets: [{
                    label: 'Vote Count',
                    data: data.top_judges.counts,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',  // Horizontal bar chart
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Votes'
                        }
                    }
                }
            }
        });
        
        // Judge vote distribution chart
        const judgeDistributionData = data.judge_vote_distribution;
        const judgeNames = Object.keys(judgeDistributionData);
        const corruptVotes = [];
        const notCorruptVotes = [];
        const undecidedVotes = [];
        
        judgeNames.forEach(name => {
            corruptVotes.push(judgeDistributionData[name].corrupt || 0);
            notCorruptVotes.push(judgeDistributionData[name].not_corrupt || 0);
            undecidedVotes.push(judgeDistributionData[name].undecided || 0);
        });
        
        new Chart(document.getElementById('judgeDistributionChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: judgeNames,
                datasets: [
                    {
                        label: 'Corrupt',
                        data: corruptVotes,
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Not Corrupt',
                        data: notCorruptVotes,
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Undecided',
                        data: undecidedVotes,
                        backgroundColor: 'rgba(255, 205, 86, 0.7)',
                        borderColor: 'rgba(255, 205, 86, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Judge Name'
                        }
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Votes'
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>